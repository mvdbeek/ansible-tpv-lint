---
- name: Create TPV mutable dir
  ansible.builtin.file:
    state: directory
    path: "{{ tpv_mutable_dir }}"
    mode: 0755
    owner: "{{ galaxy_user.name }}"
    group: "{{ galaxy_group.name }}"

- name: Copy TPV lint-and-copy-script
  ansible.builtin.template:
    src: tpv-lint-and-copy.sh.j2
    dest: "{{ tpv_mutable_dir }}/tpv-lint-and-copy.sh"
    owner: root
    group: root
    mode: 0750

- name: Execute TPV lint-and-copy-script
  ansible.builtin.script: "{{ tpv_mutable_dir }}/tpv-lint-and-copy.sh"
  register: tpv_lint
  failed_when: tpv_lint.rc >= 0
